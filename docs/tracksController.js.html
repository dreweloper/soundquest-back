<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tracksController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tracksController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Track = require('../models/trackModel');

/**
 * Handles and logs errors that occur during the function's execution.
 * @typedef {Object} ErrorObject
 * @property {Boolean} ok - Indicates if the request was successful (false).
 * @property {String} msg - A generic error message instructing the client to contact the administrator.
 * @property {Object} error - The error object caught during the catch block.
 */

/**
 * The function fetches all documents in the 'tracks' collection from the MongoDB 'soundquest' database.
 * @function getTracks
 * @async
 * @param {Object} req Receives the request object.
 * @param {Object} res Receives the response object.
 * @returns {Promise}
 */
const getTracks = async (req, res) => {

    try {

        const response = await Track.find();

        if (response.length > 0) {

            res.status(200).json({
                ok: true,
                data: response
            });

        } else {

            res.status(404).json({
                ok: false,
                msg: 'There are no tracks saved in the database.'
            });

        };

    } catch (error) {

        console.log(error);

        /**
         * @type {ErrorObject}
         */
        res.status(500).json({
            ok: false,
            msg: 'Internal server error. Something went wrong while processing your request.',
            error
        });

    };

}; //!GETTRACKS

/**
 * Retrieve a track from MongoDB based on the given track ID.
 * @function getTrackByID
 * @async
 * @param {Object} req The request object containing information about the incoming HTTP request.
 * @param {Object} res The response object used to send back an HTTP response to the client.
 * @returns {Promise&lt;void>} The function doesn't return a value directly but sends a response to the client.
 */
const getTrackByID = async (req, res) => {

    /**
     * The ID of the track to retrieve, obtained from the request parameters.
     * @type {String}
     */
    const { id } = req.params;

    try {

        /**
         * Retrieve a track using its track ID.
         * @function
         * @async
         * @param {String} id - The track ID to search for.
         * @returns {Promise&lt;Array&lt;Object>>|Promise&lt;Array>} A promise that resolves to an array containing the retrieved track or an empty array if the track is not found.
         */
        const response = await Track.find(
            { "track.track_id": id },
            { "createdAt": 0, "updatedAt": 0, "__v": 0 }
        ).limit(1); // Returns the first document that matches the search criteria.

        if (response.length == 0) { // The track is not present in MongoDB.

            res.status(404).json({
                ok: false,
                msg: `The track with ID ${id} does not exist in the database.`
            });

        } else { // The track is present in MongoDB.

            res.status(200).json({
                ok: true,
                data: response
            });

        };

    } catch (error) {

        console.log(error);

        /**
         * @type {ErrorObject}
         */
        res.status(500).json({
            ok: false,
            msg: 'Internal server error. Something went wrong while processing your request.',
            error
        });

    };

}; //!GETTRACKBYID

/**
 * Estimates the number of documents in the MongoDB 'tracks' collection.
 * @function getTracksCount
 * @async
 * @param {Object} req The request object containing information about the incoming HTTP request.
 * @param {Object} res The response object used to send back an HTTP response to the client.
 * @returns {Promise&lt;void>} The function doesn't return a value directly but sends a response to the client.
 */
const getTracksCount = async (req, res) => {

    try {

        /**
         * Estimates the number of documents in the MongoDB 'tracks' collection.
         * @function
         * @async
         * @returns {Promise&lt;Number>}
         */
        const response = await Track.estimatedDocumentCount();

        res.status(200).json({
            ok: true,
            data: response
        });

    } catch (error) {

        console.log(error);

        /**
         * @type {ErrorObject}
         */
        res.status(500).json({
            ok: false,
            msg: 'Internal server error. Something went wrong while processing your request.',
            error
        });

    };

}; //!GETTRACKSCOUNT

/**
 * The function adds a new document with the data received through the 'body' object to the 'tracks' collection of the MongoDB 'soundquest' database.
 * @function addTrack
 * @async
 * @param {Object} req Receives the request object: body.
 * @param {Object} res Receives the response object.
 * @returns {Promise}
 */
const addTrack = async (req, res) => {

    const newTrack = new Track(req.body); // 'req.body' receives the required properties of 'trackModel'.


    try {

        const response = await newTrack.save();

        if (response) {

            res.status(201).json({
                ok: true,
                data: response
            });

        } else {

            res.status(400).json({
                ok: false,
                msg: 'The track could not be saved in the database.'
            });

        };

    } catch (error) {

        console.log(error);

        /**
         * @type {ErrorObject}
         */
        res.status(500).json({
            ok: false,
            msg: 'Internal server error. Something went wrong while processing your request.',
            error
        });

    };

}; //!ADDTRACK

/**
 * The function deletes by ID a document from the "tracks" collection of the MongoDB "soundquest" database.
 * @function deleteTrack
 * @async
 * @param {Object} req Receives the request object: params.
 * @param {Object} res Receives the response object.
 * @returns {Promise}
 */
const deleteTrack = async (req, res) => {

    /**
     * The ID of the track to retrieve, obtained from the request parameters.
     * @type {String}
     */
    const { id } = req.params;

    try {

        const request = await Track.findByIdAndDelete(id);

        if (!request) {

            res.status(404).json({
                ok: false,
                msg: `The track with ID ${id} does not exist in the database and, therefore, cannot be deleted.`
            });

        } else {

            res.status(200).json({
                ok: true,
                data: request
            });

        };

    } catch (error) {

        console.log(error);

        /**
         * @type {ErrorObject}
         */
        res.status(500).json({
            ok: false,
            msg: 'Internal server error. Something went wrong while processing your request.',
            error
        });

    };

}; //!DELETETRACK


module.exports = {
    getTracks,
    getTracksCount,
    getTrackByID,
    addTrack,
    deleteTrack
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addTrack">addTrack</a></li><li><a href="global.html#addVisit">addVisit</a></li><li><a href="global.html#deleteTrack">deleteTrack</a></li><li><a href="global.html#getTrackByID">getTrackByID</a></li><li><a href="global.html#getTracks">getTracks</a></li><li><a href="global.html#getTracksCount">getTracksCount</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sat Sep 02 2023 13:24:59 GMT+0200 (hora de verano de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
